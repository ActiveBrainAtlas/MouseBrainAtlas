Code
=======

[Github repository](https://github.com/mistycheney/MouseBrainAtlas)

Data Path
============

- `REPO_DIR`: default to `/home/yuncong/Brain/`
- `DATA_DIR`: default to `CSHL_data_processed`
- `VOLUME_ROOTDIR`: 
- `MESH_ROOTDIR`:
- `REGISTRATION_PARAMETERS_ROOTDIR`:
- `PATCH_FEATURES_ROOTDIR`:
- `ANNOTATION_ROOTDIR`:
- `CLF_ROOTDIR`:
- `SCOREMAP_ROOTDIR`:
- `SCOREMAP_VIZ_ROOTDIR`:
- `REGISTRATION_VIZ_ROOTDIR`
- `MXNET_MODEL_ROOTDIR`

Image data
==========

Raw and processed images are stored in two places:
- Lab server `birdstore.dk.ucsd.edu` under `/brainbucket/data/Active_Atlas_Data/`. 
  - Raw data are stored in folders that correspond to the scanner used, e.g. `UCSD_AxioScanner/CSHL2_2018-04-04`.
  - Processed data are stored in `CSHL_data_processed` and other folders.
- AWS S3 bucket `mousebrainatlas-rawdata` and `mousebrainatlas-data`.
  - Raw data are stored in bucket `mousebrainatlas-rawdata`.
  - Processed data are stored in bucket `mousebrainatlas-data`.
       
## Naming rule ##

Every image used and generated by our system can be uniquely identified by the following information:
- image name: See below.
- version: a word that specifies a channel or the processed result of a particular channel. For example, it can be "Ntb" for neurotrace channel, "CHAT" for the ChAT channel, "NtbNormalized" for the intensity-normalized neurotrace channel.
- resolution: a word that specifies the pixel resolution. It can be "raw", "down32" (downsample raw data in both dimensions by a factor of 32), "thumbnail" (same as "down32"). It can also be an absolute physical size such as "10.0um".
- prep id: a number or word that identifies the preprocessing procedure applied, such as rotation and cropping.

### Image Name ###

Each physical section is associated with an `imageName`.
There is no fixed composition rule for image names.
The principle is that one can trace back from an image name to the physical section. Therefore in each image name, these two elements are mandatory:
- slide number
- section or scene index in the slide

Other than that, the brain id is optional but desired. Other information such as the scan date or stain name are optional.
For example, both `CHATM3_slide31_2018_02_17-S2` and `Slide31-Nissl-S2` are valid image names.
It is important to use only one composition rule for each brain. **Do not use space or special characters such as ampersand as they will not be parsed correctly in Linux commandline.**

## File Organization ##

Processed images are under `$DATA_ROOTDIR`. The path to each processed image follows the pattern `<stack>/<stack>_prep<prep_id>_<resol>_<version>/<image_name>_prep<prep_id>_<resol>_<version>.<ext>`.


**Yoav:** This data needs to be reorganized in an image storage to allow fast retrieval of individual sections and parts of sections.

## Reconstructed volumes or virtual sections
Collection of images representing virtual sections in all three directions (sagittal, coronal and horizontal).
